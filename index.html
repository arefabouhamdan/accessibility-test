<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accessible Tabs (Alpine + Tailwind + daisyUI)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.12/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>[x-cloak]{display:none !important}</style>
</head>
<body class="bg-gray-50 p-8">
  <main class="max-w-5xl mx-auto">
    <h2 id="issueHeader" class="text-2xl font-semibold text-gray-900">Issue details</h2>

    <div x-data="issueTabsComponent({ defaultTab: 'active_instances' })" x-init="initFromHash()" class="mt-6">
      <!-- Tabs Navigation -->
      <div class="tabs tabs-boxed w-full" role="tablist" aria-labelledby="issueHeader">
        <a :id="'tab-active_instances'" role="tab" :aria-controls="'tabpanel-active_instances'" :aria-selected="activeTab === 'active_instances'" :tabindex="activeTab === 'active_instances' ? 0 : -1" href="#active_instances" @click.prevent="activate('active_instances')" class="tab flex items-center gap-2" :class="activeTab === 'active_instances' ? 'tab-active' : ''">
          <span>Active</span>
          <span class="badge badge-sm" x-text="counts.active"></span>
        </a>
        <a :id="'tab-ignored_instances'" role="tab" :aria-controls="'tabpanel-ignored_instances'" :aria-selected="activeTab === 'ignored_instances'" :tabindex="activeTab === 'ignored_instances' ? 0 : -1" href="#ignored_instances" @click.prevent="activate('ignored_instances')" class="tab flex items-center gap-2" :class="activeTab === 'ignored_instances' ? 'tab-active' : ''">
          <span>Ignored</span>
          <span class="badge badge-sm" x-text="counts.ignored"></span>
        </a>
        <a :id="'tab-pending_instances'" role="tab" :aria-controls="'tabpanel-pending_instances'" :aria-selected="activeTab === 'pending_instances'" :tabindex="activeTab === 'pending_instances' ? 0 : -1" href="#pending_instances" @click.prevent="activate('pending_instances')" class="tab flex items-center gap-2" :class="activeTab === 'pending_instances' ? 'tab-active' : ''">
          <span>Pending Review</span>
          <span class="badge badge-sm" x-text="counts.pending"></span>
        </a>
        <a :id="'tab-fixed_instances'" role="tab" :aria-controls="'tabpanel-fixed_instances'" :aria-selected="activeTab === 'fixed_instances'" :tabindex="activeTab === 'fixed_instances' ? 0 : -1" href="#fixed_instances" @click.prevent="activate('fixed_instances')" class="tab flex items-center gap-2" :class="activeTab === 'fixed_instances' ? 'tab-active' : ''">
          <span>Fixed</span>
          <span class="badge badge-sm" x-text="counts.fixed"></span>
        </a>
        <a :id="'tab-comments'" role="tab" :aria-controls="'tabpanel-comments'" :aria-selected="activeTab === 'comments'" :tabindex="activeTab === 'comments' ? 0 : -1" href="#comments" @click.prevent="activate('comments')" class="tab" :class="activeTab === 'comments' ? 'tab-active' : ''">
          Comments
        </a>
      </div>

      <div class="py-4" @hashchange.window="onHashChange()">
        <!-- Active Instances Panel -->
        <div id="tabpanel-active_instances" x-cloak role="tabpanel" aria-labelledby="tab-active_instances" x-show="activeTab === 'active_instances'">
          <template x-if="counts.active > 0">
            <div>
              <div class="alert bg-blue-50 text-blue-900">
                <div>
                  <p class="mb-2" x-html="activeCalloutHtml"></p>
                  <p class="mb-2">
                    <span class="bg-yellow-100 text-yellow-900 rounded-full py-1 px-3 text-sm">Needs Manual Review</span>
                    items should be reviewed manually to determine if action is needed.
                  </p>
                  <p>Once all instances have been confirmed as fixed or ignored, the issue will be resolved.</p>
                </div>
              </div>
              <hr class="w-1/2 mx-auto my-4" />

              <template x-if="activeInstances.length > 0">
                <div>
                  <!-- Bulk actions -->
                  <div class="flex flex-wrap items-center gap-2 mb-4">
                    <button class="btn btn-sm" @click="toggleSelectAll('active')" x-text="allSelected('active') ? 'Unselect all' : 'Select all'"></button>
                    <button class="btn btn-sm btn-success" @click="markSelectedAsFixed('active')">Mark as fixed</button>
                    <button class="btn btn-sm btn-warning" @click="ignoreSelected('active')">Ignore</button>
                    <span class="text-sm text-gray-600" x-text="selectedInstances.length + ' selected'"></span>
                  </div>

                  <!-- Instances list -->
                  <template x-for="instance in activeInstances" :key="'instance-' + instance.id">
                    <div class="card bg-white shadow-sm border border-gray-200 mb-3">
                      <div class="card-body flex items-start gap-3">
                        <input type="checkbox" class="checkbox checkbox-sm mt-1" :value="instance.id" @change="toggleSelect(instance.id)" :checked="selectedInstances.includes(instance.id)" />
                        <div class="flex-1">
                          <h3 class="font-medium text-gray-900" x-text="instance.title"></h3>
                          <p class="text-sm text-gray-600" x-text="instance.path"></p>
                        </div>
                        <div class="text-sm text-gray-500" x-text="instance.severity"></div>
                      </div>
                    </div>
                  </template>

                  <div class="mt-4 flex justify-center">
                    <button class="btn btn-ghost btn-sm">Previous</button>
                    <button class="btn btn-ghost btn-sm">Next</button>
                  </div>
                </div>
              </template>
            </div>
          </template>

          <template x-if="counts.active === 0">
            <p class="text-center">There are no active instances.</p>
          </template>
        </div>

        <!-- Ignored Instances Panel -->
        <div id="tabpanel-ignored_instances" x-cloak role="tabpanel" aria-labelledby="tab-ignored_instances" x-show="activeTab === 'ignored_instances'">
          <div class="alert bg-blue-50 text-blue-900">
            <p>These instances will be ignored when seen in a scan. If all instances are ignored, the issue is considered resolved.</p>
          </div>
          <hr class="w-1/2 mx-auto my-4" />

          <template x-if="ignoredInstances.length > 0">
            <div>
              <div class="flex flex-wrap items-center gap-2 mb-4">
                <button class="btn btn-sm" @click="toggleSelectAll('ignored')" x-text="allSelected('ignored') ? 'Unselect all' : 'Select all'"></button>
                <button class="btn btn-sm btn-success" @click="markSelectedAsFixed('ignored')">Mark as fixed</button>
                <button class="btn btn-sm btn-neutral" @click="unignoreSelected()">Unignore</button>
                <span class="text-sm text-gray-600" x-text="selectedInstances.length + ' selected'"></span>
              </div>

              <template x-for="instance in ignoredInstances" :key="'ignored-instance-' + instance.id">
                <div class="card bg-white shadow-sm border border-gray-200 mb-3">
                  <div class="card-body flex items-start gap-3">
                    <input type="checkbox" class="checkbox checkbox-sm mt-1" :value="instance.id" @change="toggleSelect(instance.id)" :checked="selectedInstances.includes(instance.id)" />
                    <div class="flex-1">
                      <h3 class="font-medium text-gray-900" x-text="instance.title"></h3>
                      <p class="text-sm text-gray-600" x-text="instance.path"></p>
                    </div>
                    <div class="text-sm text-gray-500" x-text="instance.severity"></div>
                  </div>
                </div>
              </template>

              <div class="mt-4 flex justify-center">
                <button class="btn btn-ghost btn-sm">Previous</button>
                <button class="btn btn-ghost btn-sm">Next</button>
              </div>
            </div>
          </template>

          <template x-if="ignoredInstances.length === 0">
            <p class="text-center">There are no ignored instances.</p>
          </template>
        </div>

        <!-- Pending Review Instances Panel -->
        <div id="tabpanel-pending_instances" x-cloak role="tabpanel" aria-labelledby="tab-pending_instances" x-show="activeTab === 'pending_instances'">
          <template x-if="pendingInstances.length > 0">
            <div>
              <div class="flex flex-wrap items-center gap-2 mb-4">
                <button class="btn btn-sm" @click="toggleSelectAll('pending')" x-text="allSelected('pending') ? 'Unselect all' : 'Select all'"></button>
                <button class="btn btn-sm btn-success" @click="markSelectedAsFixed('pending')">Mark as fixed</button>
                <button class="btn btn-sm btn-warning" @click="ignoreSelected('pending')">Ignore</button>
                <span class="text-sm text-gray-600" x-text="selectedInstances.length + ' selected'"></span>
              </div>

              <template x-for="instance in pendingInstances" :key="'pending-instance-' + instance.id">
                <div class="card bg-white shadow-sm border border-gray-200 mb-3">
                  <div class="card-body flex items-start gap-3">
                    <input type="checkbox" class="checkbox checkbox-sm mt-1" :value="instance.id" @change="toggleSelect(instance.id)" :checked="selectedInstances.includes(instance.id)" />
                    <div class="flex-1">
                      <h3 class="font-medium text-gray-900" x-text="instance.title"></h3>
                      <p class="text-sm text-gray-600" x-text="instance.path"></p>
                    </div>
                    <div class="text-sm text-gray-500" x-text="instance.severity"></div>
                  </div>
                </div>
              </template>

              <div class="mt-4 flex justify-center">
                <button class="btn btn-ghost btn-sm">Previous</button>
                <button class="btn btn-ghost btn-sm">Next</button>
              </div>
            </div>
          </template>
          <template x-if="pendingInstances.length === 0">
            <p class="text-center">There are no pending review instances.</p>
          </template>
        </div>

        <!-- Fixed Instances Panel -->
        <div id="tabpanel-fixed_instances" x-cloak role="tabpanel" aria-labelledby="tab-fixed_instances" x-show="activeTab === 'fixed_instances'">
          <template x-if="fixedInstances.length > 0">
            <div>
              <template x-for="instance in fixedInstances" :key="'fixed-instance-' + instance.id">
                <div class="card bg-white shadow-sm border border-gray-200 mb-3">
                  <div class="card-body">
                    <h3 class="font-medium text-gray-900" x-text="instance.title"></h3>
                    <p class="text-sm text-gray-600" x-text="instance.path"></p>
                    <span class="badge badge-success">Fixed</span>
                  </div>
                </div>
              </template>
              <div class="mt-4 flex justify-center">
                <button class="btn btn-ghost btn-sm">Previous</button>
                <button class="btn btn-ghost btn-sm">Next</button>
              </div>
            </div>
          </template>
          <template x-if="fixedInstances.length === 0">
            <p class="text-center">There are no fixed instances.</p>
          </template>
        </div>

        <!-- Comments Panel -->
        <div id="tabpanel-comments" x-cloak role="tabpanel" aria-labelledby="tab-comments" x-show="activeTab === 'comments'">
          <template x-if="firstComment">
            <div class="mb-6">
              <div class="card bg-white border border-gray-200 shadow-sm">
                <div class="card-body">
                  <div class="flex items-center justify-between">
                    <div class="font-medium" x-text="firstComment.user ?? 'Deleted Account'"></div>
                    <div class="text-xs text-gray-500" x-text="firstComment.timestamp"></div>
                  </div>
                  <p class="mt-2 text-gray-700" x-text="firstComment.body"></p>
                </div>
              </div>
              <div class="py-4">
                <div class="flex items-center justify-center gap-2">
                  <a href="#" class="btn btn-circle btn-outline btn-sm" @click.prevent="showAllComments = true" :title="'Load ' + (comments.length - initialCommentsToShow - 1) + ' older comments.'">
                    <span x-text="comments.length - initialCommentsToShow - 1"></span>
                  </a>
                  <hr class="w-6" />
                  <a href="#" class="link" @click.prevent="showAllComments = true" x-text="'older comments'"></a>
                  <hr class="flex-1" />
                </div>
              </div>
            </div>
          </template>

          <template x-for="comment in visibleComments" :key="'comment-'+comment.id">
            <div class="card bg-white border border-gray-200 shadow-sm mb-4">
              <div class="card-body">
                <div class="flex items-center justify-between">
                  <div class="font-medium" x-text="comment.user ?? 'Deleted Account'"></div>
                  <div class="text-xs text-gray-500" x-text="comment.timestamp"></div>
                </div>
                <p class="mt-2 text-gray-700" x-text="comment.body"></p>
              </div>
            </div>
          </template>

          <template x-if="visibleComments.length === 0">
            <p>No Comments</p>
          </template>

          <!-- Comment form (static demo) -->
          <form class="card bg-white border border-gray-200 shadow-sm mt-6" @submit.prevent>
            <div class="card-body gap-3">
              <label class="form-control w-full">
                <div class="label"><span class="label-text">Add a comment</span></div>
                <textarea class="textarea textarea-bordered w-full" rows="3" placeholder="Type here..."></textarea>
              </label>
              <div>
                <button class="btn btn-primary btn-sm" type="button">Submit</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <script>
    function issueTabsComponent({ defaultTab = 'active_instances' } = {}) {
      return {
        activeTab: defaultTab,
        selectedInstances: [],
        initialCommentsToShow: 2,
        showAllComments: false,

        // Mock data mirroring the Blade example semantics
        activeInstances: [
          { id: 1, title: 'Image missing alt attribute', path: '/about', severity: 'High' },
          { id: 2, title: 'Low color contrast on button', path: '/pricing', severity: 'Medium' },
          { id: 3, title: 'Form input missing label', path: '/signup', severity: 'High' },
        ],
        ignoredInstances: [
          { id: 11, title: 'Decorative image flagged', path: '/home', severity: 'Low' },
        ],
        pendingInstances: [
          { id: 21, title: 'Keyboard focus not visible', path: '/contact', severity: 'High' },
        ],
        fixedInstances: [
          { id: 31, title: 'Headings out of order', path: '/blog', severity: 'Medium' },
        ],
        firstComment: {
          id: 100,
          user: 'Alex Doe',
          body: 'Initial note about this issue. Click to load older comments.',
          timestamp: '2 hours ago',
        },
        comments: [
          { id: 101, user: 'Jane', body: 'Checked the page, still reproducible.', timestamp: '1 hour ago' },
          { id: 102, user: 'Sam', body: 'Added more details to the ticket.', timestamp: '45 minutes ago' },
          { id: 103, user: 'Chris', body: 'Working on a fix now.', timestamp: '30 minutes ago' },
        ],

        get counts() {
          return {
            active: this.activeInstances.length,
            ignored: this.ignoredInstances.length,
            pending: this.pendingInstances.length,
            fixed: this.fixedInstances.length,
          };
        },

        get visibleComments() {
          if (this.showAllComments) return this.comments;
          return this.comments.slice(0, this.initialCommentsToShow);
        },

        get activeCalloutHtml() {
          const reopened = '<span class="text-red-800 rounded-full py-1 px-3 text-sm bg-red-100">Reopened<\/span>';
          return `We found ${this.counts.active} active instances of this issue across your site. You can flag an instance as fixed, and we will confirm during the next scan. If we see the exact same instance is still active, we'll flag it as ${reopened} for you to take another look.`;
        },

        initFromHash() {
          const hash = window.location.hash.replace('#', '');
          const allowed = ['active_instances','ignored_instances','pending_instances','fixed_instances','comments'];
          if (allowed.includes(hash)) {
            this.activeTab = hash;
          } else {
            this.activeTab = defaultTab;
            history.replaceState(null, '', `#${defaultTab}`);
          }
        },

        onHashChange() {
          const hash = window.location.hash.replace('#', '');
          if (hash && hash !== this.activeTab) this.activeTab = hash;
        },

        activate(tab) {
          this.activeTab = tab;
          if (window.location.hash !== `#${tab}`) {
            history.replaceState(null, '', `#${tab}`);
          }
        },

        toggleSelect(id) {
          const idx = this.selectedInstances.indexOf(id);
          if (idx >= 0) this.selectedInstances.splice(idx, 1);
          else this.selectedInstances.push(id);
        },

        allSelected(scope) {
          const ids = this.idsByScope(scope);
          return ids.length > 0 && ids.every(id => this.selectedInstances.includes(id));
        },

        toggleSelectAll(scope) {
          const ids = this.idsByScope(scope);
          if (this.allSelected(scope)) {
            this.selectedInstances = this.selectedInstances.filter(id => !ids.includes(id));
          } else {
            const toAdd = ids.filter(id => !this.selectedInstances.includes(id));
            this.selectedInstances = this.selectedInstances.concat(toAdd);
          }
        },

        idsByScope(scope) {
          if (scope === 'active') return this.activeInstances.map(i => i.id);
          if (scope === 'ignored') return this.ignoredInstances.map(i => i.id);
          if (scope === 'pending') return this.pendingInstances.map(i => i.id);
          return [];
        },

        markSelectedAsFixed(scope) {
          const ids = this.idsByScope(scope);
          const chosen = this.selectedInstances.filter(id => ids.includes(id));
          if (chosen.length === 0) return;
          const move = (from) => {
            const moved = [];
            from = from.filter(item => {
              if (chosen.includes(item.id)) { moved.push(item); return false; }
              return true;
            });
            return { from, moved };
          };
          if (scope === 'active') {
            const res = move(this.activeInstances);
            this.activeInstances = res.from;
            this.fixedInstances = this.fixedInstances.concat(res.moved);
          } else if (scope === 'ignored') {
            const res = move(this.ignoredInstances);
            this.ignoredInstances = res.from;
            this.fixedInstances = this.fixedInstances.concat(res.moved);
          } else if (scope === 'pending') {
            const res = move(this.pendingInstances);
            this.pendingInstances = res.from;
            this.fixedInstances = this.fixedInstances.concat(res.moved);
          }
          this.selectedInstances = this.selectedInstances.filter(id => !chosen.includes(id));
        },

        ignoreSelected(scope) {
          const ids = this.idsByScope(scope);
          const chosen = this.selectedInstances.filter(id => ids.includes(id));
          if (chosen.length === 0) return;
          if (scope === 'active') {
            const kept = [];
            const moved = [];
            this.activeInstances.forEach(item => (chosen.includes(item.id) ? moved.push(item) : kept.push(item)));
            this.activeInstances = kept;
            this.ignoredInstances = this.ignoredInstances.concat(moved);
          } else if (scope === 'pending') {
            const kept = [];
            const moved = [];
            this.pendingInstances.forEach(item => (chosen.includes(item.id) ? moved.push(item) : kept.push(item)));
            this.pendingInstances = kept;
            this.ignoredInstances = this.ignoredInstances.concat(moved);
          }
          this.selectedInstances = this.selectedInstances.filter(id => !chosen.includes(id));
        },

        unignoreSelected() {
          const ids = this.idsByScope('ignored');
          const chosen = this.selectedInstances.filter(id => ids.includes(id));
          if (chosen.length === 0) return;
          const kept = [];
          const moved = [];
          this.ignoredInstances.forEach(item => (chosen.includes(item.id) ? moved.push(item) : kept.push(item)));
          this.ignoredInstances = kept;
          this.activeInstances = this.activeInstances.concat(moved);
          this.selectedInstances = this.selectedInstances.filter(id => !chosen.includes(id));
        },
      };
    }
  </script>
</body>
</html>